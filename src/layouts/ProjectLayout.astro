---
import Layout from "./Layout.astro";
import { Image } from "astro:assets";
import SkillBadge from "../components/SkillBadge.astro";
import { ExternalLink } from "@lucide/astro";

interface Props {
  title: string;
  description: string;
  startDate: Date;
  endDate?: Date;
  image: any;
  skills: string[];
  demoLink?: string;
  sourceLink?: string;
}

const {
  title,
  description,
  startDate,
  endDate,
  image,
  skills,
  demoLink,
  sourceLink,
} = Astro.props;

function formatPeriod(startDate: Date, endDate?: Date) {
  const options: Intl.DateTimeFormatOptions = {
    month: "short",
    year: "numeric",
  };
  const start = startDate.toLocaleDateString("en-US", options);
  const end = endDate
    ? endDate.toLocaleDateString("en-US", options)
    : "Present";
  return `${start} - ${end}`;
}

// Calculate project duration
function calculateDuration(startDate: Date, endDate?: Date) {
  const end = endDate || new Date();
  const months =
    (end.getFullYear() - startDate.getFullYear()) * 12 +
    (end.getMonth() - startDate.getMonth());

  if (months < 1) return "Less than a month";
  if (months === 1) return "1 month";
  if (months < 12) return `${months} months`;

  const years = Math.floor(months / 12);
  const remainingMonths = months % 12;

  if (remainingMonths === 0) return years === 1 ? "1 year" : `${years} years`;
  return `${years} year${years > 1 ? "s" : ""}, ${remainingMonths} month${remainingMonths > 1 ? "s" : ""}`;
}
---

<Layout title={title} description={description}>
  <article class="max-w-4xl mx-auto px-4 py-20">
    <!-- Back button -->
    <div class="mb-8">
      <a href="/projects" class="btn btn-ghost btn-sm">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="m15 18-6-6 6-6"></path>
        </svg>
        Back to Projects
      </a>
    </div>

    <!-- Featured Image -->
    <!-- TODO: Future Enhancement - Support multiple images/project gallery -->
    {
      image && (
        <figure class="mb-8 rounded-2xl overflow-hidden">
          <Image
            src={image}
            alt={title}
            class="w-full aspect-video object-cover"
            width={1200}
            height={630}
          />
        </figure>
      )
    }

    <!-- Project Header -->
    <header class="mb-8">
      <h1 class="text-5xl font-bold mb-4">{title}</h1>
      <p class="text-xl text-base-content/70 mb-6">{description}</p>

      <div
        class="flex flex-wrap items-center gap-4 text-sm text-base-content/60 mb-6"
      >
        <span class="font-semibold">{formatPeriod(startDate, endDate)}</span>
        <span>•</span>
        <span>{calculateDuration(startDate, endDate)}</span>
        {
          !endDate && (
            <>
              <span>•</span>
              <span class="badge badge-success badge-sm">Ongoing</span>
            </>
          )
        }
      </div>

      <!-- Prominent Action Buttons -->
      {
        (demoLink || sourceLink) && (
          <div class="flex flex-wrap gap-3 mb-6">
            {demoLink && (
              <a
                href={demoLink}
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-primary gap-2"
              >
                <ExternalLink class="size-5" />
                Live Demo
              </a>
            )}
            {sourceLink && (
              <a
                href={sourceLink}
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-soft gap-2"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 32 32"
                  fill="currentColor"
                >
                  <path d="M16,2.345c7.735,0,14,6.265,14,14-.002,6.015-3.839,11.359-9.537,13.282-.7,.14-.963-.298-.963-.665,0-.473,.018-1.978,.018-3.85,0-1.312-.437-2.152-.945-2.59,3.115-.35,6.388-1.54,6.388-6.912,0-1.54-.543-2.783-1.435-3.762,.14-.35,.63-1.785-.14-3.71,0,0-1.173-.385-3.85,1.435-1.12-.315-2.31-.472-3.5-.472s-2.38,.157-3.5,.472c-2.677-1.802-3.85-1.435-3.85-1.435-.77,1.925-.28,3.36-.14,3.71-.892,.98-1.435,2.24-1.435,3.762,0,5.355,3.255,6.563,6.37,6.913-.403,.35-.77,.963-.893,1.872-.805,.368-2.818,.963-4.077-1.155-.263-.42-1.05-1.452-2.152-1.435-1.173,.018-.472,.665,.017,.927,.595,.332,1.277,1.575,1.435,1.978,.28,.787,1.19,2.293,4.707,1.645,0,1.173,.018,2.275,.018,2.607,0,.368-.263,.787-.963,.665-5.719-1.904-9.576-7.255-9.573-13.283,0-7.735,6.265-14,14-14Z" />
                </svg>
                View Source
              </a>
            )}
          </div>
        )
      }
    </header>

    <!-- Tech Stack Showcase -->
    {
      skills && skills.length > 0 && (
        <div class="card bg-base-200 mb-8">
          <div class="card-body">
            <h2 class="card-title text-lg mb-3">Tech Stack</h2>
            <div class="flex flex-wrap gap-2">
              {skills.map((skill) => (
                <SkillBadge skill={skill} />
              ))}
            </div>
          </div>
        </div>
      )
    }

    <!-- Divider -->
    <div class="divider"></div>

    <!-- Project Content -->
    <div class="prose prose-lg max-w-none">
      <slot />
    </div>

    <!-- Divider -->
    <div class="divider mt-12"></div>

    <!-- Back to projects link -->
    <div class="text-center mt-8">
      <a href="/projects" class="btn btn-primary"> View All Projects </a>
    </div>
  </article>
</Layout>

